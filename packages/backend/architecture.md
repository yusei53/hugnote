# バックエンド アーキテクチャ構成

## ディレクトリ構成

```
/src
├── index.ts                # エントリーポイント・ルーティング
├── controllers/            # コントローラー層
├── usecase/                # ユースケース層
│   ├── request/            # リクエストDTO・バリデーション
│   └── response/           # レスポンスDTO
├── domain/                 # ドメイン層
│   ├── entity/             # エンティティ・型定義
│   │   └── User.ts
│   │   └── __tests__/      # エンティティのテスト
│   ├── event/              # ドメインイベント
│   ├── value-object/       # 値オブジェクト
│   │   └── UUID.ts
│   ├── service/            # ドメインサービス
│   └── repository/         # リポジトリ
├── config/                 # 設定
│   └── container.ts        # DIコンテナ（依存性注入の管理。各クラスのインスタンス生成と依存解決を一元管理。ルーティングでコントローラを利用する際は、ここからインスタンスをimport）
```

## 各層の役割

- **controllers/**
  - HTTPリクエストを受け取り、バリデーション・ユースケース呼び出し・レスポンス返却を担当
  - クラスベースで実装し、ユースケースをコンストラクタで受け取る（DI）

- **usecase/**
  - アプリケーション固有のビジネスロジックを記述
  - クラスベースで実装し、リポジトリなどをコンストラクタで受け取る（DI）
  - request/response配下でDTOやバリデーションを管理

- **domain/**
  - ドメインエンティティ、値オブジェクト、ドメインサービス、リポジトリ、イベントを管理
  - `entity/`：エンティティ・型定義
  - `value-object/`：値オブジェクト
  - `service/`：ドメインサービス
  - `repository/`：リポジトリ
  - `event/`：ドメインイベント

- **config/container.ts**
  - 各クラスのインスタンス生成と依存解決を一元管理
  - DI（依存性注入）の設定を担う
  - ルーティングでコントローラを利用する際は、ここからインスタンスをimport

## DI（依存性注入）について

- 各層はコンストラクタインジェクションで依存を受け取る
- テスト時は依存クラスをモックに差し替えることで、柔軟な単体テストが可能
- interfaceは利用せず、クラスベースのみで実装しているが、十分にテスト容易性・拡張性を確保

## テスト容易性

- 依存を差し替えられるため、Jest等でモックを渡してユースケースやコントローラの単体テストが容易
- interfaceを使わなくても、クラスのメソッドをオーバーライドしたり、jest.fn()で差し替え可能

---
