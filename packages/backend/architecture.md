# バックエンド アーキテクチャ構成

## ディレクトリ構成

```
src/
├── domain/
│   ├── models/           # ドメインモデル（エンティティ）
│   │   └── value-objects/    # 値オブジェクト
│   │
│   ├── services/         # ドメインサービス
│   ├── events/           # ドメインイベント
│   └── repositories/     # ドメインリポジトリ
│
├── application/
│   ├── dtos/             # DTO（データ転送オブジェクト）
│   ├── usecases/         # ユースケース（アプリケーションサービス）
│   └── services/         # アプリケーションサービス
│
├── infrastructure/
│   ├── orm/              # ORMやDBアクセス層
│   ├── events/           # インフラ層のイベント連携
│   └── config/           # 設定（DIコンテナ等）
│
├── presentation/
│   ├── controllers/      # コントローラー層
│   ├── routes/           # ルーティング
│   └── middleware/       # ミドルウェア
│
├── utils/                # 汎用ユーティリティ
│   └── UUID.ts           # 例: UUID生成など
│
└── index.ts              # エントリーポイント
```

## 各層の役割

- **domain/**

  - ビジネスルールの中心。エンティティ（models）、ドメインサービス（services）、ドメインイベント（events）、リポジトリインターフェース（repositories）を管理。

- **application/**

  - ユースケースやDTO、アプリケーションサービスを管理。ドメイン層のオブジェクトを組み合わせてアプリケーション固有の処理を実装。

- **infrastructure/**

  - DBや外部サービス連携、設定など技術的な詳細を管理。ORMやイベント連携、DIコンテナ設定など。

- **presentation/**

  - コントローラー、ルーティング、ミドルウェアなど、外部からの入出力（HTTP等）を担当。

- **utils/**

  - 汎用的なユーティリティ関数やクラスを配置。例: UUID生成など

- **index.ts**
  - アプリケーションのエントリーポイント。

## DI（依存性注入）について

- 各層はコンストラクタインジェクションで依存を受け取る
- テスト時は依存クラスをモックに差し替えることで、柔軟な単体テストが可能
- interfaceは利用せず、クラスベースのみで実装しているが、十分にテスト容易性・拡張性を確保

## テスト容易性

- 依存を差し替えられるため、Jest等でモックを渡してユースケースやコントローラの単体テストが容易
- interfaceを使わなくても、クラスのメソッドをオーバーライドしたり、jest.fn()で差し替え可能

---
